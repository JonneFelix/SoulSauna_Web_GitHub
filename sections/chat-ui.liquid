<!-- chat-ui.liquid -->
<div id="chat-container" data-profile-pic-url="https://cdn.shopify.com/s/files/1/0819/3094/4843/t/3/assets/finn-profile-pic.jpg?v=1712725211">
  <div id="chat-header">
    <span id="chat-title">Chat mit Finn</span>
  </div>
  <div id="chat-messages">
    <!-- Nachrichten werden hier über JavaScript eingefügt -->
  </div>
  <div id="chat-input-container">
    <textarea id="chat-input" placeholder="Schreiben Sie eine Nachricht..." onkeypress="checkForEnter(event)"></textarea>
    <button id="chat-send" onclick="sendMessage()">⇨</button>
  </div>
</div>




<!-- Styles für die Chat-UI -->
<style>
@media (max-width: 600px) {
  #chat-container {
    max-width: 100%;
    padding: 15px;
  }

  #chat-input {
    width: calc(100% - 30px); /* Anpassung für kleinere Geräte */
  }

  #chat-send {
    width: 25px;
    height: 25px;
    right: 5px;
    bottom: 5px;
  }
}

  #chat-header {
    display: flex;
    align-items: center;
    justify-content: space-between; /* Zentriert den Titel nicht mehr, sondern verteilt die Elemente */
    padding: 15px;
    background-color: #C19A6B;
    color: white;
  }

  .profile-pic {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
  }

  .chat-message {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    line-height: 1.4;
    padding: 8px 12px;
    border-radius: 20px;
    background-color: #e8e8e8;
    max-width: 80%;
  }

  .chat-message.incoming {
    background-color: #e8e8e8;
    align-self: flex-start;
  }

  .chat-message.outgoing {
    background-color: #b6defd;
    align-self: flex-end;
  }

  #chat-input-container {
    position: relative;
    padding-top: 10px;
  }

  #chat-input {
    width: calc(100% - 50px);
    padding: 10px;
    border: 1px solid #eaeaea;
    border-radius: 8px;
    margin-right: 10px;
  }

  #chat-send {
    position: absolute;
    right: 10px;
    bottom: 10px;
    background-color: #C19A6B;
    border: none;
    color: white;
    cursor: pointer;
    width: 30px;
    height: 30px;
  }
</style>


<!-- JavaScript, um die Nachrichten zu verwalten und mit dem Backend zu kommunizieren -->
<script>
function typeMessage(fullText, type) {
  let index = 0;
  let container = document.getElementById('chat-messages');
  let messageDiv = document.createElement('div');
  messageDiv.classList.add('chat-message', type);

  // Füge das Profilbild nur zu eingehenden Nachrichten hinzu
  if (type === 'incoming') {
    const profilePicUrl = document.getElementById('chat-container').getAttribute('data-profile-pic-url');
    messageDiv.innerHTML = `<img src="${profilePicUrl}" class="profile-pic">`;
  }

  container.appendChild(messageDiv);
  const textSpan = document.createElement('span');
  messageDiv.appendChild(textSpan);

  function typeStep() {
    if (index < fullText.length) {
      textSpan.textContent += fullText[index];
      index++;
      setTimeout(typeStep, 20);
    }
  }
  
  typeStep();
}
  
function displayMessage(text, type) {
  const messagesContainer = document.getElementById('chat-messages');
  const messageDiv = document.createElement('div');
  messageDiv.classList.add('chat-message', type);
  
  // Setze die Nachricht direkt in das Nachrichten-Div
  messageDiv.innerHTML = type === 'incoming' ? 
    `<img src="${document.getElementById('chat-container').getAttribute('data-profile-pic-url')}" class="profile-pic">${text}` : text;

  messagesContainer.scrollTop = messagesContainer.scrollHeight; // Ändern zu:
  messagesContainer.scrollIntoView({ behavior: 'smooth', block: 'end' });
}



// sendMessage-Funktion, die Typewriter-Effekt für ausgehende Nachrichten verwendet
function sendMessage() {
  var input = document.getElementById('chat-input');
  var message = input.value.trim();
  
  if (message) {
    displayMessage(message, 'outgoing');
    input.value = ''; // Clear the input field
    
    fetch('/sendMessage', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({message: message}),
    })
    .then(response => response.json())
    .then(data => {
      // Nach Erhalt der Antwort, zeige diese mit Typewriter-Effekt an
      typeMessage(data.answer, 'incoming');
    })
    .catch((error) => {
      console.error('Error:', error);
    });
  }
}

// EventListener für das Senden bei Eingabe von Enter
function checkForEnter(event) {
  if (event.keyCode === 13) {
    event.preventDefault(); // Verhindert einen Zeilenumbruch
    sendMessage();
  }
}

// Eventuell kannst du hier eine Logik hinzufügen, um "Schnelle Antworten" zu implementieren
function addQuickReplies(options) {
  const container = document.getElementById('chat-messages');
  const repliesDiv = document.createElement('div');
  repliesDiv.classList.add('quick-replies');

  options.forEach(option => {
    const button = document.createElement('button');
    button.textContent = option.label;
    button.onclick = function() { sendMessage(option.message); };
    repliesDiv.appendChild(button);
  });

  container.appendChild(repliesDiv);
}

document.getElementById('chat-send').addEventListener('click', sendMessage);

// Zeige eine Begrüßungsnachricht beim Laden der Seite an
setTimeout(function() {
  typeMessage("Hallo, ich bin Finn, der Saunaflüsterer. Wofür brauchst du eine Sauna und wie stellst du sie dir vor?", 'incoming');
}, 3000);
</script>